{
    "Comment": "ModelBuildingWorkflow_Prod",
    "StartAt": "data-processing-job",
    "States": {
        "data-processing-job": {
            "Parameters": {
                "ProcessingJobName": "prod--data-processing--2024-10-28-154128",
                "ProcessingResources": {
                    "ClusterConfig": {
                        "InstanceCount": 1,
                        "InstanceType": "ml.t3.large",
                        "VolumeSizeInGB": 30
                    }
                },
                "StoppingCondition": {
                    "MaxRuntimeInSeconds": 300
                },
                "AppSpecification": {
                    "ImageUri": "097866913509.dkr.ecr.sa-east-1.amazonaws.com/ml-accelerator-ecr:prod-image-v1.0.0",
                    "ContainerEntrypoint": [
                        "python3",
                        "scripts/data_processing/data_processing.py"
                    ],
                    "ContainerArguments": [
                        "--fit_transformers",
                        "True",
                        "--save_transformers",
                        "True",
                        "--persist_datasets",
                        "True",
                        "--write_mode",
                        "overwrite"
                    ]
                },
                "Environment": {
                    "ENV": "prod",
                    "DATA_STORAGE_ENV": "S3",
                    "MODEL_STORAGE_ENV": "S3",
                    "REGION_NAME": "sa-east-1",
                    "BUCKET_NAME": "ml-accelerator-bucket-prod",
                    "KXY_API_KEY": "pXdUYRKRYO9T0tLQ6jrU73oUZuwwMlOljD8Ob0T4",
                    "INFERENCE_HOST": "0.0.0.0",
                    "INFERENCE_PORT": "8080",
                    "WEBAPP_HOST": "localhost",
                    "WEBAPP_PORT": "8501",
                    "RAW_DATASETS_PATH": "datasets/raw",
                    "PROCESSING_DATASETS_PATH": "datasets/processing",
                    "INFERENCE_PATH": "inference",
                    "TRANSFORMERS_PATH": "transformers",
                    "MODELS_PATH": "models",
                    "SCHEMAS_PATH": "schemas",
                    "STEP_FUNCTIONS_PATH": "step_functions",
                    "MOCK_PATH": "mock",
                    "SEED": "23111997"
                },
                "RoleArn": "arn:aws:iam::097866913509:role/SageMakerExecutionRole-MLAccelerator-Prod",
                "Tags": [
                    {
                        "Key": "Project",
                        "Value": "ml_accelerator"
                    },
                    {
                        "Key": "Version",
                        "Value": "v1.0.0"
                    },
                    {
                        "Key": "Environment",
                        "Value": "prod"
                    }
                ],
                "ProcessingInputs": [
                    {
                        "InputName": "raw-data",
                        "AppManaged": true,
                        "S3Input": {
                            "S3Uri": "s3://ml-accelerator-bucket-prod/datasets/raw/df_raw/",
                            "LocalPath": "/opt/ml/processing/input",
                            "S3DataType": "S3Prefix",
                            "S3InputMode": "File",
                            "S3DataDistributionType": "FullyReplicated",
                            "S3CompressionType": "None"
                        }
                    }
                ],
                "ProcessingOutputConfig": {
                    "Outputs": [
                        {
                            "OutputName": "X-data",
                            "S3Output": {
                                "S3Uri": "s3://ml-accelerator-bucket-prod/datasets/processing/X_FeatureSelector/",
                                "LocalPath": "/opt/ml/processing/output/X",
                                "S3UploadMode": "EndOfJob"
                            },
                            "AppManaged": true
                        },
                        {
                            "OutputName": "y-data",
                            "S3Output": {
                                "S3Uri": "s3://ml-accelerator-bucket-prod/datasets/processing/y_FeatureSelector/",
                                "LocalPath": "/opt/ml/processing/output/y",
                                "S3UploadMode": "EndOfJob"
                            },
                            "AppManaged": true
                        }
                    ]
                }
            },
            "Type": "Task",
            "Resource": "arn:aws:states:::sagemaker:createProcessingJob.sync",
            "Next": "tuning-job"
        },
        "tuning-job": {
            "Parameters": {
                "ProcessingJobName": "prod--tuning--2024-10-28-154128",
                "ProcessingResources": {
                    "ClusterConfig": {
                        "InstanceCount": 1,
                        "InstanceType": "ml.t3.large",
                        "VolumeSizeInGB": 30
                    }
                },
                "StoppingCondition": {
                    "MaxRuntimeInSeconds": 300
                },
                "AppSpecification": {
                    "ImageUri": "097866913509.dkr.ecr.sa-east-1.amazonaws.com/ml-accelerator-ecr:prod-image-v1.0.0",
                    "ContainerEntrypoint": [
                        "python3",
                        "scripts/tuning/tuning.py"
                    ]
                },
                "Environment": {
                    "ENV": "prod",
                    "DATA_STORAGE_ENV": "S3",
                    "MODEL_STORAGE_ENV": "S3",
                    "REGION_NAME": "sa-east-1",
                    "BUCKET_NAME": "ml-accelerator-bucket-prod",
                    "KXY_API_KEY": "pXdUYRKRYO9T0tLQ6jrU73oUZuwwMlOljD8Ob0T4",
                    "INFERENCE_HOST": "0.0.0.0",
                    "INFERENCE_PORT": "8080",
                    "WEBAPP_HOST": "localhost",
                    "WEBAPP_PORT": "8501",
                    "RAW_DATASETS_PATH": "datasets/raw",
                    "PROCESSING_DATASETS_PATH": "datasets/processing",
                    "INFERENCE_PATH": "inference",
                    "TRANSFORMERS_PATH": "transformers",
                    "MODELS_PATH": "models",
                    "SCHEMAS_PATH": "schemas",
                    "STEP_FUNCTIONS_PATH": "step_functions",
                    "MOCK_PATH": "mock",
                    "SEED": "23111997"
                },
                "RoleArn": "arn:aws:iam::097866913509:role/SageMakerExecutionRole-MLAccelerator-Prod",
                "Tags": [
                    {
                        "Key": "Project",
                        "Value": "ml_accelerator"
                    },
                    {
                        "Key": "Version",
                        "Value": "v1.0.0"
                    },
                    {
                        "Key": "Environment",
                        "Value": "prod"
                    }
                ],
                "ProcessingInputs": [
                    {
                        "InputName": "X-data",
                        "AppManaged": true,
                        "S3Input": {
                            "S3Uri": "s3://ml-accelerator-bucket-prod/datasets/processing/X_FeatureSelector/",
                            "LocalPath": "/opt/ml/processing/input/X",
                            "S3DataType": "S3Prefix",
                            "S3InputMode": "File",
                            "S3DataDistributionType": "FullyReplicated",
                            "S3CompressionType": "None"
                        }
                    },
                    {
                        "InputName": "y-data",
                        "AppManaged": true,
                        "S3Input": {
                            "S3Uri": "s3://ml-accelerator-bucket-prod/datasets/processing/y_FeatureSelector/",
                            "LocalPath": "/opt/ml/processing/input/y",
                            "S3DataType": "S3Prefix",
                            "S3InputMode": "File",
                            "S3DataDistributionType": "FullyReplicated",
                            "S3CompressionType": "None"
                        }
                    }
                ],
                "ProcessingOutputConfig": {
                    "Outputs": [
                        {
                            "OutputName": "tuning-output",
                            "S3Output": {
                                "S3Uri": "s3://ml-accelerator-bucket-prod/datasets/processing/X_FeatureSelector/",
                                "LocalPath": "/opt/ml/processing/output",
                                "S3UploadMode": "EndOfJob"
                            },
                            "AppManaged": true
                        }
                    ]
                }
            },
            "Type": "Task",
            "Resource": "arn:aws:states:::sagemaker:createProcessingJob.sync",
            "Next": "training-job"
        },
        "training-job": {
            "Parameters": {
                "ProcessingJobName": "prod--training--2024-10-28-154128",
                "ProcessingResources": {
                    "ClusterConfig": {
                        "InstanceCount": 1,
                        "InstanceType": "ml.t3.large",
                        "VolumeSizeInGB": 30
                    }
                },
                "StoppingCondition": {
                    "MaxRuntimeInSeconds": 300
                },
                "AppSpecification": {
                    "ImageUri": "097866913509.dkr.ecr.sa-east-1.amazonaws.com/ml-accelerator-ecr:prod-image-v1.0.0",
                    "ContainerEntrypoint": [
                        "python3",
                        "scripts/training/training.py"
                    ],
                    "ContainerArguments": [
                        "--train_prod_pipe",
                        "True",
                        "--train_staging_pipes",
                        "True",
                        "--train_dev_pipes",
                        "False"
                    ]
                },
                "Environment": {
                    "ENV": "prod",
                    "DATA_STORAGE_ENV": "S3",
                    "MODEL_STORAGE_ENV": "S3",
                    "REGION_NAME": "sa-east-1",
                    "BUCKET_NAME": "ml-accelerator-bucket-prod",
                    "KXY_API_KEY": "pXdUYRKRYO9T0tLQ6jrU73oUZuwwMlOljD8Ob0T4",
                    "INFERENCE_HOST": "0.0.0.0",
                    "INFERENCE_PORT": "8080",
                    "WEBAPP_HOST": "localhost",
                    "WEBAPP_PORT": "8501",
                    "RAW_DATASETS_PATH": "datasets/raw",
                    "PROCESSING_DATASETS_PATH": "datasets/processing",
                    "INFERENCE_PATH": "inference",
                    "TRANSFORMERS_PATH": "transformers",
                    "MODELS_PATH": "models",
                    "SCHEMAS_PATH": "schemas",
                    "STEP_FUNCTIONS_PATH": "step_functions",
                    "MOCK_PATH": "mock",
                    "SEED": "23111997"
                },
                "RoleArn": "arn:aws:iam::097866913509:role/SageMakerExecutionRole-MLAccelerator-Prod",
                "Tags": [
                    {
                        "Key": "Project",
                        "Value": "ml_accelerator"
                    },
                    {
                        "Key": "Version",
                        "Value": "v1.0.0"
                    },
                    {
                        "Key": "Environment",
                        "Value": "prod"
                    }
                ],
                "ProcessingInputs": [
                    {
                        "InputName": "raw-data",
                        "AppManaged": true,
                        "S3Input": {
                            "S3Uri": "s3://ml-accelerator-bucket-prod/datasets/raw/df_raw/",
                            "LocalPath": "/opt/ml/processing/input",
                            "S3DataType": "S3Prefix",
                            "S3InputMode": "File",
                            "S3DataDistributionType": "FullyReplicated",
                            "S3CompressionType": "None"
                        }
                    }
                ],
                "ProcessingOutputConfig": {
                    "Outputs": [
                        {
                            "OutputName": "training-output",
                            "S3Output": {
                                "S3Uri": "s3://ml-accelerator-bucket-prod/datasets/processing/X_FeatureSelector/",
                                "LocalPath": "/opt/ml/processing/output",
                                "S3UploadMode": "EndOfJob"
                            },
                            "AppManaged": true
                        }
                    ]
                }
            },
            "Type": "Task",
            "Resource": "arn:aws:states:::sagemaker:createProcessingJob.sync",
            "Next": "evaluating-job"
        },
        "evaluating-job": {
            "Parameters": {
                "ProcessingJobName": "prod--evaluating--2024-10-28-154128",
                "ProcessingResources": {
                    "ClusterConfig": {
                        "InstanceCount": 1,
                        "InstanceType": "ml.t3.large",
                        "VolumeSizeInGB": 30
                    }
                },
                "StoppingCondition": {
                    "MaxRuntimeInSeconds": 300
                },
                "AppSpecification": {
                    "ImageUri": "097866913509.dkr.ecr.sa-east-1.amazonaws.com/ml-accelerator-ecr:prod-image-v1.0.0",
                    "ContainerEntrypoint": [
                        "python3",
                        "scripts/evaluating/evaluating.py"
                    ],
                    "ContainerArguments": [
                        "--evaluate_prod_pipe",
                        "True",
                        "--evaluate_staging_pipes",
                        "True",
                        "--evaluate_dev_pipes",
                        "True",
                        "--update_model_stages",
                        "True",
                        "--update_prod_model",
                        "False"
                    ]
                },
                "Environment": {
                    "ENV": "prod",
                    "DATA_STORAGE_ENV": "S3",
                    "MODEL_STORAGE_ENV": "S3",
                    "REGION_NAME": "sa-east-1",
                    "BUCKET_NAME": "ml-accelerator-bucket-prod",
                    "KXY_API_KEY": "pXdUYRKRYO9T0tLQ6jrU73oUZuwwMlOljD8Ob0T4",
                    "INFERENCE_HOST": "0.0.0.0",
                    "INFERENCE_PORT": "8080",
                    "WEBAPP_HOST": "localhost",
                    "WEBAPP_PORT": "8501",
                    "RAW_DATASETS_PATH": "datasets/raw",
                    "PROCESSING_DATASETS_PATH": "datasets/processing",
                    "INFERENCE_PATH": "inference",
                    "TRANSFORMERS_PATH": "transformers",
                    "MODELS_PATH": "models",
                    "SCHEMAS_PATH": "schemas",
                    "STEP_FUNCTIONS_PATH": "step_functions",
                    "MOCK_PATH": "mock",
                    "SEED": "23111997"
                },
                "RoleArn": "arn:aws:iam::097866913509:role/SageMakerExecutionRole-MLAccelerator-Prod",
                "Tags": [
                    {
                        "Key": "Project",
                        "Value": "ml_accelerator"
                    },
                    {
                        "Key": "Version",
                        "Value": "v1.0.0"
                    },
                    {
                        "Key": "Environment",
                        "Value": "prod"
                    }
                ],
                "ProcessingInputs": [
                    {
                        "InputName": "raw-data",
                        "AppManaged": true,
                        "S3Input": {
                            "S3Uri": "s3://ml-accelerator-bucket-prod/datasets/raw/df_raw/",
                            "LocalPath": "/opt/ml/processing/input",
                            "S3DataType": "S3Prefix",
                            "S3InputMode": "File",
                            "S3DataDistributionType": "FullyReplicated",
                            "S3CompressionType": "None"
                        }
                    }
                ],
                "ProcessingOutputConfig": {
                    "Outputs": [
                        {
                            "OutputName": "evaluating-output",
                            "S3Output": {
                                "S3Uri": "s3://ml-accelerator-bucket-prod/datasets/processing/X_FeatureSelector/",
                                "LocalPath": "/opt/ml/processing/output",
                                "S3UploadMode": "EndOfJob"
                            },
                            "AppManaged": true
                        }
                    ]
                }
            },
            "Type": "Task",
            "Resource": "arn:aws:states:::sagemaker:createProcessingJob.sync",
            "End": true
        }
    }
}